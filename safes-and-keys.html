<!DOCTYPE html>
<html lang="en">
 
<head>
  <title>Test - Safes and Keys</title>

  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <!-- import meta.html stuff -->

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" type="text/css" href="https://amelrod.github.io/forktest/theme/css/style.min.css?feb40fa0" />

  <!-- TODO i don't understand feeds yet
  <link href="https://amelrod.github.io/forktest/feed.xml" type="application/atom+xml" rel="alternate" title="Test Atom Feed" />
  <link href="https://amelrod.github.io/forktest/" type="application/rss+xml" rel="alternate" title="Test RSS Feed" />
  <link href="https://amelrod.github.io/forktest/" type="application/atom+xml" rel="alternate" title="Test Atom Feed" />
  <link href="https://amelrod.github.io/forktest/" type="application/rss+xml" rel="alternate" title="Test RSS Feed" /> -->
        
</head>

<body>
  <header class="site-header">
  	<nav>
      <ul>
        <li><a href="https://amelrod.github.io/forktest/">home</a></li>
        <li><a href="https://amelrod.github.io/forktest/about">about</a></li>
        <li><a href="https://github.com/HenrySwanson/HenrySwanson.github.io">source</a></li>
      </ul>
    </nav>
    <h1>Test</h1>
    <h2>A work in progress.</h2>
  </header>

<section>
  <header>
    <h1 class="article-title">
      <a href="https://amelrod.github.io/forktest/safes-and-keys" title="Permalink to Safes and Keys">Safes and Keys</a>
    </h1>
    <div class="article-date">November 16, 2018</div>

    <div class="article-tags">
      tags:
      <a href="https://amelrod.github.io/forktest/tag/puzzles">puzzles</a>
      <a href="https://amelrod.github.io/forktest/tag/combinatorics">combinatorics</a>
    </div>
  </header>

  <section><p>Here&rsquo;s a few similar puzzles with a common story:</p>
<blockquote>
<p>I have <em>n</em> safes, each one with a unique key that opens it. Unfortunately, some prankster snuck into my office last night and stole my key ring. It seems they&rsquo;ve randomly put the keys inside the safes (one key per safe), and locked them.</p>
</blockquote>
<p>We&rsquo;ll play around with a few different conditions and see what chances we have of getting all safes unlocked, and at what cost.</p>
<!-- more -->

<hr>
<p><strong>1) The prankster was a bit sloppy, and forgot to lock one of the safes. What is the probability I can unlock all of my safes?</strong></p>
<p>The key observation here, as with the subsequent problems, is to consider the arrangement of keys and safes as a permutation. Label the safes and keys <span class="math">\(1\)</span> to <span class="math">\(n\)</span>, and define <span class="math">\(\pi(i)\)</span> to be the number of the key inside the <span class="math">\(i\)</span>th safe. So, if we have key <span class="math">\(1\)</span>, we unlock safe <span class="math">\(1\)</span> to reveal key <span class="math">\(\pi(1)\)</span>.</p>
<p>Under this interpretation, key <span class="math">\(i\)</span> lets us unlock all safes in the cycle containing <span class="math">\(i\)</span>; we open a safe, find a new key, track down the new safe, and repeat until we end up where we started. So, we want to know the probability that a randomly chosen permutation has exactly one cycle.</p>
<p>This isn&rsquo;t too hard; we can count the number of one-cycle permutations in a straightforward way. Given a permutation of one cycle, we start with element <span class="math">\(1\)</span>, we write out <span class="math">\(\pi(1)\)</span>, <span class="math">\(\pi(\pi(1))\)</span>, etc, until we loop back to <span class="math">\(1\)</span>. This produces an ordered list of <span class="math">\(n\)</span> numbers, starting with <span class="math">\(1\)</span>, and this uniquely determines the cycle. There are <span class="math">\((n-1)!\)</span> such lists, and so the probability of having exactly one cycle is <span class="math">\((n-1)!/n! = 1/n\)</span></p>
<hr>
<p><strong>2) Say the prankster is sloppier, and leaves k safes unlocked. Now what is my probability of success?</strong></p>
<p>This one requires a little more thought. It&rsquo;s tempting to consider permutations with <span class="math">\(k\)</span> cycles, but that&rsquo;s not quite right. If there&rsquo;s only one cycle, we&rsquo;re sure to succeed, and furthermore, even if there are <span class="math">\(k\)</span> cycles, our success isn&rsquo;t guaranteed: we could pick two safes in the same cycle.</p>
<p>By symmetry, label our safes so that we&rsquo;ve picked safes <span class="math">\(1\)</span>, <span class="math">\(2\)</span>, &hellip;, <span class="math">\(k\)</span>. We&rsquo;d like to know how many permutations have a cycle that completely avoid <span class="math">\(1\)</span> through <span class="math">\(k\)</span>. If, and only if, such a cycle is present, we fail to unlock all the safes.</p>
<p>Let <span class="math">\(a_i\)</span> be the number of &ldquo;good&rdquo; permutations when there are <span class="math">\(i\)</span> safes. We will express <span class="math">\(a_n\)</span> in terms of smaller <span class="math">\(a_i\)</span>s, and solve the resulting recurrence relation.</p>
<p>Given a permutation <span class="math">\(\pi\)</span>, we can split the set <span class="math">\(\{ 1, \ldots n \}\)</span> into two parts: those that have cycles intersecting <span class="math">\(\{ 1, \ldots, k \}\)</span>, and those that do not. (It may help to think of these sets as &ldquo;reachable&rdquo; and &ldquo;unreachable&rdquo; safes, respectively). Since <span class="math">\(\pi\)</span> never sends a reachable safe to an unreachable one, or vice versa, it induces permutations on both these sets. Also, knowing both these subpermutations, we can reconstruct <span class="math">\(\pi\)</span>. So, let&rsquo;s count how many possible permutations there are on the reachable and unreachable sets.</p>
<p>If there are <span class="math">\(r\)</span> reachable safes, then there are <span class="math">\(a_r\)</span> possible permutations induced on the reachable set, and <span class="math">\((n-r)!\)</span> induced on the unreachable one. (The reason we don&rsquo;t get the full <span class="math">\(r!\)</span> on the reachable set is that some permutations would leave a safe unreachable, when it&rsquo;s supposed to be reachable.) Furthermore, we have a choice of <em>which</em> safes are reachable. The first <span class="math">\(k\)</span> safes must be reachable, so beyond that, we have <span class="math">\(\binom{n-k}{r-k}\)</span> more choices to make. Our recurrence relation is then:
</p>
<div class="math">$$ n! = \sum_{r = k}^n \binom{n-k}{r-k} a_r (n-r)! = \sum_{r = k}^n a_r \frac{(n-k)!}{(r-k)!} $$</div>
<p>Since <span class="math">\((n-k)!\)</span> doesn&rsquo;t depend on <span class="math">\(r\)</span>, we can pull it out to get a neater-looking form:
</p>
<div class="math">$$ \frac{n!}{(n-k)!} = \sum_{r=k}^n \frac{a_r}{(r-k)!} $$</div>
<p>Now <span class="math">\(n\)</span> only shows up as an index, not anywhere in the summand. This lets us collapse our sum; take this term, and subtract it from the corresponding one for <span class="math">\(n-1\)</span>:
</p>
<div class="math">$$
\begin{align*}
\frac{n!}{(n-k)!} - \frac{(n-1)!}{(n-1-k)!} &amp;= \left( \sum_{r=k}^n \frac{a_r}{(r-k)!} \right) - \left( \sum_{r=k}^{n-1} \frac{a_r}{(r-k)!} \right) \\
\frac{n!}{(n-k)!} - \frac{(n-1)!}{(n-1-k)!} &amp;= \frac{a_n}{(n-k)!} \\
n! - (n-1)!(n-k) &amp;= a_n \\
k \cdot (n-1)! &amp;= a_n
\end{align*}
$$</div>
<p>So there&rsquo;s <span class="math">\(k \cdot (n-1)!\)</span> permutations in which we win. Since there&rsquo;s <span class="math">\(n!\)</span> total, this gives our probability of success at <span class="math">\(k/n\)</span>.</p>
<hr>
<p><strong>3) If the prankster is careful, and remembers to lock all the safes, then I have no choice but to break some of them open. What&rsquo;s the expected number of safes I have to crack?</strong></p>
<p>This one&rsquo;s much easier than 2). The question here is just &ldquo;how many cycles are there in a random permutation&rdquo;, and <a href="/linearity-expectation">from a previous post</a>, we know that&rsquo;s <span class="math">\(H_n\)</span>, the <span class="math">\(n\)</span>th harmonic number.</p>
<hr>
<p><strong>4) Putting it all together: if we start with <span class="math">\(k\)</span> safes unlocked, what&rsquo;s the expected number of safes I have to crack open?</strong></p>
<p>I haven&rsquo;t actually put this one on solid ground yet! It&rsquo;s not coming out pretty.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/latest.js?config=TeX-AMS-MML_HTMLorMML';

    var configscript = document.createElement('script');
    configscript.type = 'text/x-mathjax-config';
    configscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'none' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        availableFonts: ['STIX', 'TeX']," +
        "        preferredFont: 'STIX'," +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";

    (document.body || document.getElementsByTagName('head')[0]).appendChild(configscript);
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script></section>

  <footer>
  </footer>

</section>
  <!-- TODO make sure filtering on tags and stuff works -->

  <footer class="site-footer">
  	<!-- TODO apparently this background color is in a few of the icons -->
  	<a href="mailto:abmelrod@umd.edu"><i class="svg-icon email"></i></a>
  	<a href="https://github.com/amelrod"><i class="svg-icon github"></i></a>
  </footer>
  <!-- TODO powered by pelican -->

  </body>
</html>